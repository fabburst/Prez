<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mémorisation par Répétition Espacée</title>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-color: #667eea;
    --secondary-color: #764ba2;
    --success-color: #48bb78;
    --danger-color: #f56565;
    --warning-color: #ed8936;
    --background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --surface: rgba(255, 255, 255, 0.95);
    --surface-secondary: rgba(255, 255, 255, 0.8);
    --text-primary: #333;
    --text-secondary: #666;
    --border-color: #e2e8f0;
    --shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

[data-theme="dark"] {
    --primary-color: #4c51bf;
    --secondary-color: #553c9a;
    --success-color: #38a169;
    --danger-color: #e53e3e;
    --warning-color: #dd6b20;
    --background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    --surface: rgba(45, 55, 72, 0.95);
    --surface-secondary: rgba(45, 55, 72, 0.8);
    --text-primary: #f7fafc;
    --text-secondary: #a0aec0;
    --border-color: #4a5568;
    --shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--background);
    min-height: 100vh;
    padding: 20px;
    color: var(--text-primary);
    transition: all 0.3s ease;
}

.container {
    max-width: 1000px;
    margin: 0 auto;
    background: var(--surface);
    border-radius: 20px;
    padding: 30px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
    position: relative;
}

/* Menu Burger */
.menu-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    transition: all 0.3s ease;
}

.menu-toggle:hover {
    transform: scale(1.1);
}

.settings-menu {
    position: absolute;
    top: 70px;
    right: 20px;
    background: var(--surface);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    box-shadow: var(--shadow);
    z-index: 999;
    min-width: 250px;
    transform: translateX(100%);
    opacity: 0;
    transition: all 0.3s ease;
}

.settings-menu.active {
    transform: translateX(0);
    opacity: 1;
}

.settings-menu h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.2em;
}

.setting-item {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
}

.setting-label {
    color: var(--text-primary);
    font-size: 14px;
    flex: 1;
    min-width: 120px;
}

.setting-control {
    flex: 0 0 auto;
}

.setting-control input[type="range"] {
    width: 100px;
}

.setting-control input[type="number"] {
    width: 60px;
    padding: 5px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background: var(--surface);
    color: var(--text-primary);
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    width: 50px;
    height: 25px;
    background: var(--border-color);
    border-radius: 25px;
    cursor: pointer;
    transition: background 0.3s ease;
}

.toggle-switch.active {
    background: var(--success-color);
}

.toggle-switch::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 21px;
    height: 21px;
    background: white;
    border-radius: 50%;
    transition: transform 0.3s ease;
}

.toggle-switch.active::before {
    transform: translateX(25px);
}

h1 {
    text-align: center;
    color: var(--text-primary);
    margin-bottom: 30px;
    font-size: 2.5em;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    padding-right: 60px;
}

.section {
    margin-bottom: 30px;
    padding: 20px;
    background: var(--surface-secondary);
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.section h2 {
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.5em;
}

textarea {
    width: 100%;
    height: 150px;
    padding: 15px;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    font-size: 16px;
    resize: vertical;
    background: var(--surface);
    color: var(--text-primary);
    transition: border-color 0.3s ease;
}

textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.btn {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 16px;
    margin: 10px 5px;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
}

.btn:active {
    transform: translateY(0);
}

.btn-secondary {
    background: linear-gradient(135deg, var(--success-color) 0%, #38a169 100%);
}

.btn-danger {
    background: linear-gradient(135deg, var(--danger-color) 0%, #e53e3e 100%);
}

.btn-warning {
    background: linear-gradient(135deg, var(--warning-color) 0%, #dd6b20 100%);
}

.blocks-container {
    display: grid;
    gap: 20px;
    margin-top: 20px;
}

.block {
    background: var(--surface);
    border: 2px solid var(--border-color);
    border-radius: 15px;
    padding: 20px;
    transition: all 0.3s ease;
    position: relative;
}

.block:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.block.hidden {
    background: var(--surface-secondary);
    border-color: var(--border-color);
}

.block.memorized {
    background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
    border-color: var(--success-color);
}

[data-theme="dark"] .block.memorized {
    background: linear-gradient(135deg, #22543d 0%, #2f855a 100%);
}

.block-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 10px;
}

.block-number {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 14px;
}

.block-stats {
    display: flex;
    gap: 10px;
    font-size: 12px;
    color: var(--text-secondary);
    flex-wrap: wrap;
}

.stat-badge {
    background: var(--surface-secondary);
    padding: 4px 8px;
    border-radius: 10px;
    border: 1px solid var(--border-color);
}

.stat-badge.review-due {
    background: var(--warning-color);
    color: white;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

.block-content {
    font-size: 16px;
    line-height: 1.6;
    color: var(--text-primary);
    margin-bottom: 15px;
}

.block-content.hidden-text {
    color: transparent;
    text-shadow: 0 0 8px var(--text-primary);
    user-select: none;
}

.hint-text {
    background: var(--surface-secondary);
    padding: 10px 15px;
    border-radius: 10px;
    margin: 10px 0;
    border-left: 4px solid var(--warning-color);
    font-style: italic;
    color: var(--text-secondary);
}

.block-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}

.progress-bar {
    width: 100%;
    height: 20px;
    background: var(--border-color);
    border-radius: 10px;
    overflow: hidden;
    margin: 20px 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--success-color) 0%, #38a169 100%);
    transition: width 0.5s ease;
    border-radius: 10px;
}

.session-info {
    background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 20px;
}

[data-theme="dark"] .session-info {
    background: linear-gradient(135deg, #742a2a 0%, #9c4221 100%);
}

.session-info h3 {
    color: var(--text-primary);
    margin-bottom: 15px;
    font-size: 1.3em;
    text-align: center;
}

.timer {
    font-size: 24px;
    font-weight: bold;
    color: var(--danger-color);
    text-align: center;
    margin: 10px 0;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.stat-card {
    background: var(--surface);
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--border-color);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
}

.stat-value {
    font-size: 2em;
    font-weight: bold;
    color: var(--primary-color);
}

.stat-label {
    color: var(--text-secondary);
    font-size: 14px;
    margin-top: 5px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 15px;
        margin: 10px;
    }
    
    h1 {
        font-size: 1.8em;
        padding-right: 50px;
    }
    
    .menu-toggle {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    
    .settings-menu {
        right: 10px;
        min-width: 220px;
    }
    
    .block-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .block-stats {
        width: 100%;
        justify-content: flex-start;
    }
    
    .block-actions {
        justify-content: center;
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        margin: 5px 0;
    }
    
    .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
    
    .setting-item {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .setting-control {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
}

@media (max-width: 480px) {
    body {
        padding: 10px;
    }
    
    .container {
        padding: 10px;
    }
    
    h1 {
        font-size: 1.5em;
    }
    
    .section {
        padding: 15px;
    }
    
    .block {
        padding: 15px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .setting-control input[type="range"] {
        width: 80px;
    }
    
    .setting-control input[type="number"] {
        width: 50px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <button class="menu-toggle" onclick="toggleSettingsMenu()">⚙️</button>
        
        <div class="settings-menu" id="settingsMenu">
            <h3>⚙️ Préférences</h3>
            <div class="setting-item">
                <label class="setting-label">Nombre de mots pour l'indice :</label>
                <div class="setting-control">
                    <input type="range" id="hintWordsRange" min="1" max="10" value="3" oninput="updateHintWords(this.value)">
                    <input type="number" id="hintWordsNumber" min="1" max="10" value="3" onchange="updateHintWords(this.value)">
                </div>
            </div>
            <div class="setting-item">
                <label class="setting-label">Mode sombre :</label>
                <div class="setting-control">
                    <div class="toggle-switch" id="darkModeToggle" onclick="toggleDarkMode()"></div>
                </div>
            </div>
        </div>

        <h1>🧠 Mémorisation par Répétition Espacée</h1>
        
        <div class="section">
            <h2>📝 Texte à mémoriser</h2>
            <textarea id="textInput" placeholder="Collez votre texte ici pour le diviser en blocs..."></textarea>
            <div>
                <button class="btn" onclick="createBlocks()">Créer les blocs</button>
                <button class="btn btn-secondary" onclick="loadExample()">Exemple de texte</button>
                <button class="btn btn-danger" onclick="clearAll()">Tout effacer</button>
            </div>
        </div>

        <div class="session-info" id="sessionInfo" style="display: none;">
            <h3>📅 Session d'apprentissage</h3>
            <div class="timer" id="timer">00:00</div>
            <div>Bloc actuel : <span id="currentBlock">1</span> / <span id="totalBlocks">0</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <div class="section" id="blocksSection" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                <h2>📚 Blocs de mémorisation</h2>
                <div>
                    <button class="btn" onclick="startSession()">Commencer session</button>
                    <button class="btn btn-secondary" onclick="toggleAllBlocks()">Cacher/Montrer tout</button>
                </div>
            </div>
            <div class="blocks-container" id="blocksContainer"></div>
        </div>

        <div class="section" id="statsSection" style="display: none;">
            <h2>📊 Statistiques</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalSessions">0</div>
                    <div class="stat-label">Sessions totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTime">0</div>
                    <div class="stat-label">Temps total (min)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="memorizedBlocks">0</div>
                    <div class="stat-label">Blocs mémorisés</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">Taux de réussite</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let blocks = [];
let currentSession = null;
let sessionTimer = null;
let sessionStartTime = null;
let settings = {
    hintWords: 3,
    darkMode: false
};
let stats = {
    totalSessions: 0,
    totalTime: 0,
    memorizedCount: 0,
    totalAttempts: 0
};

// Charger les données au démarrage
document.addEventListener('DOMContentLoaded', function() {
    loadData();
});

// Charger les données sauvegardées
function loadData() {
    try {
        const savedBlocks = JSON.parse(localStorage.getItem('memorization_blocks') || '[]');
        const savedStats = JSON.parse(localStorage.getItem('memorization_stats') || '{}');
        const savedSettings = JSON.parse(localStorage.getItem('memorization_settings') || '{}');
        
        blocks = savedBlocks;
        stats = { ...stats, ...savedStats };
        settings = { ...settings, ...savedSettings };
        
        // Appliquer les paramètres
        document.getElementById('hintWordsRange').value = settings.hintWords;
        document.getElementById('hintWordsNumber').value = settings.hintWords;
        
        if (settings.darkMode) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('darkModeToggle').classList.add('active');
        }
        
        if (blocks.length > 0) {
            displayBlocks();
        }
        updateStats();
    } catch (error) {
        console.error('Erreur lors du chargement des données:', error);
    }
}

// Sauvegarder les données
function saveData() {
    try {
        localStorage.setItem('memorization_blocks', JSON.stringify(blocks));
        localStorage.setItem('memorization_stats', JSON.stringify(stats));
        localStorage.setItem('memorization_settings', JSON.stringify(settings));
    } catch (error) {
        console.error('Erreur lors de la sauvegarde:', error);
    }
}

// Toggle menu des paramètres
function toggleSettingsMenu() {
    const menu = document.getElementById('settingsMenu');
    menu.classList.toggle('active');
    
    // Fermer le menu si on clique ailleurs
    if (menu.classList.contains('active')) {
        setTimeout(() => {
            document.addEventListener('click', closeSettingsMenu);
        }, 100);
    }
}

function closeSettingsMenu(event) {
    const menu = document.getElementById('settingsMenu');
    const toggle = document.querySelector('.menu-toggle');
    
    if (!menu.contains(event.target) && !toggle.contains(event.target)) {
        menu.classList.remove('active');
        document.removeEventListener('click', closeSettingsMenu);
    }
}

// Mettre à jour le nombre de mots pour l'indice
function updateHintWords(value) {
    settings.hintWords = parseInt(value);
    document.getElementById('hintWordsRange').value = value;
    document.getElementById('hintWordsNumber').value = value;
    saveData();
    if (blocks.length > 0) {
        displayBlocks(); // Actualiser l'affichage des indices
    }
}

// Toggle mode sombre
function toggleDarkMode() {
    settings.darkMode = !settings.darkMode;
    const toggle = document.getElementById('darkModeToggle');
    
    if (settings.darkMode) {
        document.documentElement.setAttribute('data-theme', 'dark');
        toggle.classList.add('active');
    } else {
        document.documentElement.removeAttribute('data-theme');
        toggle.classList.remove('active');
    }
    
    saveData();
}

// Créer les blocs à partir du texte
function createBlocks() {
    const text = document.getElementById('textInput').value.trim();
    if (!text) {
        alert('Veuillez saisir un texte à mémoriser.');
        return;
    }

    // Diviser le texte en phrases
    const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
    blocks = [];

    // Créer des blocs de 3-4 phrases
    for (let i = 0; i < sentences.length; i += 3) {
        const blockSentences = sentences.slice(i, i + 3);
        blocks.push({
            id: i / 3 + 1,
            content: blockSentences.join('. ').trim() + '.',
            sentences: blockSentences.map(s => s.trim()),
            hidden: false,
            showingHint: false,
            repetitions: 0,
            lastReview: null,
            memorized: false,
            attempts: 0,
            successes: 0
        });
    }

    displayBlocks();
    saveData();
}

// Charger un exemple de texte
function loadExample() {
    const exampleText = `La mémorisation par répétition espacée est une technique d'apprentissage puissante. Elle consiste à réviser les informations à des intervalles de temps de plus en plus longs. Cette méthode exploite l'effet d'espacement pour optimiser la rétention à long terme.

Le principe repose sur la courbe de l'oubli découverte par Hermann Ebbinghaus. Selon cette théorie, nous oublions rapidement les nouvelles informations. Cependant, chaque révision renforce la mémoire et ralentit le processus d'oubli.

L'algorithme de répétition espacée adapte les intervalles selon la difficulté. Les concepts faciles sont révisés moins souvent. Les concepts difficiles nécessitent des révisions plus fréquentes jusqu'à leur maîtrise complète.`;
    
    document.getElementById('textInput').value = exampleText;
}

// Générer l'indice pour un bloc
function generateHint(block) {
    return block.sentences.map(sentence => {
        const words = sentence.trim().split(/\s+/);
        const hintWords = words.slice(0, settings.hintWords);
        return hintWords.join(' ') + (words.length > settings.hintWords ? '...' : '');
    }).join('\n');
}

// Afficher les blocs
function displayBlocks() {
    if (blocks.length === 0) return;

    document.getElementById('blocksSection').style.display = 'block';
    document.getElementById('statsSection').style.display = 'block';
    
    const container = document.getElementById('blocksContainer');
    container.innerHTML = '';

    blocks.forEach((block, index) => {
        const blockElement = document.createElement('div');
        blockElement.className = `block ${block.memorized ? 'memorized' : ''} ${block.hidden ? 'hidden' : ''}`;
        
        const nextReview = getNextReviewTime(block);
        const isReviewTime = !nextReview || new Date() >= nextReview;
        
        blockElement.innerHTML = `
            <div class="block-header">
                <div class="block-number">Bloc ${block.id}</div>
                <div class="block-stats">
                    <span class="stat-badge">Répétitions: ${block.repetitions}</span>
                    <span class="stat-badge">Réussite: ${block.attempts ? Math.round((block.successes / block.attempts) * 100) : 0}%</span>
                    ${nextReview ? `<span class="stat-badge ${isReviewTime ? 'review-due' : ''}">
                        Prochaine révision: ${nextReview.toLocaleTimeString()}
                    </span>` : ''}
                </div>
            </div>
            <div class="block-content ${block.hidden ? 'hidden-text' : ''}" id="content-${index}">
                ${block.content}
            </div>
            ${block.showingHint ? `<div class="hint-text" id="hint-${index}">
                💡 <strong>Indice (${settings.hintWords} mots par phrase) :</strong><br>
                ${generateHint(block).replace(/\n/g, '<br>')}
            </div>` : ''}
            <div class="block-actions">
                <button class="btn" onclick="toggleBlock(${index})">
                    ${block.hidden ? 'Montrer' : 'Cacher'}
                </button>
                <button class="btn btn-warning" onclick="toggleHint(${index})">
                    ${block.showingHint ? 'Cacher indice' : 'Indice'}
                </button>
                <button class="btn ${block.memorized ? 'btn-danger' : 'btn-secondary'}" onclick="toggleMemorized(${index})">
                    ${block.memorized ? 'Non mémorisé' : 'Mémorisé'}
                </button>
            </div>
        `;
        
        container.appendChild(blockElement);
    });

    updateStats();
}

// Calculer le prochain temps de révision (répétition espacée)
function getNextReviewTime(block) {
    if (!block.lastReview) return null;
    
    const intervals = [5, 15, 60, 240, 1440]; // minutes: 5min, 15min, 1h, 4h, 24h
    const intervalIndex = Math.min(block.repetitions - 1, intervals.length - 1);
    const interval = intervals[intervalIndex];
    
    return new Date(new Date(block.lastReview).getTime() + interval * 60000);
}

// Basculer la visibilité d'un bloc
function toggleBlock(index) {
    blocks[index].hidden = !blocks[index].hidden;
    blocks[index].attempts++;
    stats.totalAttempts++;
    displayBlocks();
    saveData();
}

// Basculer l'indice d'un bloc
function toggleHint(index) {
    blocks[index].showingHint = !blocks[index].showingHint;
    displayBlocks();
    saveData();
}

// Basculer tous les blocs
function toggleAllBlocks() {
    const allHidden = blocks.every(block => block.hidden);
    blocks.forEach(block => {
        block.hidden = !allHidden;
        block.showingHint = false; // Masquer tous les indices
    });
    displayBlocks();
    saveData();
}

// Basculer le statut mémorisé
function toggleMemorized(index) {
    const wasMemorized = blocks[index].memorized;
    blocks[index].memorized = !blocks[index].memorized;
    
    if (blocks[index].memorized && !wasMemorized) {
        blocks[index].repetitions++;
        blocks[index].lastReview = new Date();
        blocks[index].successes++;
        stats.memorizedCount++;
    } else if (!blocks[index].memorized && wasMemorized) {
        stats.memorizedCount = Math.max(0, stats.memorizedCount - 1);
    }
    
    displayBlocks();
    saveData();
}

// PARTIE MANQUANTE - Fonctions pour les sessions et statistiques
function startSession() {
    const blocksToReview = blocks.filter(block => !block.memorized);
    if (blocksToReview.length === 0) {
        alert('Tous les blocs sont déjà mémorisés !');
        return;
    }

    // Initialiser la session
    currentSession = {
        blocks: blocksToReview,
        currentIndex: 0,
        startTime: new Date(),
        reviewedBlocks: []
    };

    sessionStartTime = new Date();
    stats.totalSessions++;
    
    // Afficher l'info de session
    document.getElementById('sessionInfo').style.display = 'block';
    document.getElementById('totalBlocks').textContent = blocksToReview.length;
    
    // Démarrer le chronomètre
    startTimer();
    
    // Cacher automatiquement tous les blocs
    blocks.forEach(block => {
        block.hidden = true;
        block.showingHint = false;
    });
    
    displayBlocks();
    updateSessionProgress();
    saveData();
}

function startTimer() {
    if (sessionTimer) clearInterval(sessionTimer);
    
    sessionTimer = setInterval(() => {
        if (sessionStartTime) {
            const elapsed = Math.floor((new Date() - sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
    }, 1000);
}

function endSession() {
    if (sessionTimer) {
        clearInterval(sessionTimer);
        sessionTimer = null;
    }
    
    if (sessionStartTime) {
        const sessionDuration = Math.floor((new Date() - sessionStartTime) / 60000); // en minutes
        stats.totalTime += sessionDuration;
        sessionStartTime = null;
    }
    
    document.getElementById('sessionInfo').style.display = 'none';
    currentSession = null;
    updateStats();
    saveData();
}

function updateSessionProgress() {
    if (!currentSession) return;
    
    const progress = (currentSession.reviewedBlocks.length / currentSession.blocks.length) * 100;
    document.getElementById('progressFill').style.width = `${progress}%`;
    document.getElementById('currentBlock').textContent = currentSession.reviewedBlocks.length + 1;
    
    if (currentSession.reviewedBlocks.length >= currentSession.blocks.length) {
        setTimeout(() => {
            alert('Session terminée ! Bien joué !');
            endSession();
        }, 1000);
    }
}

function updateStats() {
    const memorizedCount = blocks.filter(block => block.memorized).length;
    const successRate = stats.totalAttempts > 0 ? 
        Math.round((memorizedCount / stats.totalAttempts) * 100) : 0;
    
    document.getElementById('totalSessions').textContent = stats.totalSessions;
    document.getElementById('totalTime').textContent = stats.totalTime;
    document.getElementById('memorizedBlocks').textContent = memorizedCount;
    document.getElementById('successRate').textContent = `${successRate}%`;
}

function clearAll() {
    if (confirm('Êtes-vous sûr de vouloir tout effacer ?')) {
        blocks = [];
        stats = {
            totalSessions: 0,
            totalTime: 0,
            memorizedCount: 0,
            totalAttempts: 0
        };
        
        if (sessionTimer) {
            clearInterval(sessionTimer);
            sessionTimer = null;
        }
        
        currentSession = null;
        sessionStartTime = null;
        
        document.getElementById('textInput').value = '';
        document.getElementById('blocksSection').style.display = 'none';
        document.getElementById('statsSection').style.display = 'none';
        document.getElementById('sessionInfo').style.display = 'none';
        
        updateStats();
        saveData();
    }
}
</script>
    </html>